<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZERA - Choose Your Mood</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="upload-styles.css">
    <link rel="stylesheet" href="animated-bg.css">
    <script src="animated-bg.js"></script>
    <style>
        /* Override scrolling behavior */
        html, body {
            height: auto !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }

        /* Full-screen iframe background */
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: auto; /* Ensure the background receives pointer events */
        }

        .background-container iframe {
            width: 100vw;
            height: 100vh;
            border: none;
            pointer-events: auto; /* Ensure the iframe receives pointer events */
        }

        /* Make the body pass through pointer events to the background */
        body {
            pointer-events: none;
        }

        /* But enable pointer events for all interactive elements */
        header, .mood-container, button, .mood-card, .action-btn, .back-link {
            pointer-events: auto;
        }

        .mood-container {
            max-width: 800px;
            margin: 120px auto 40px;
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 20px rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 2;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header-nav {
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: #1a2b3c;
            text-decoration: none;
            font-family: 'Azonix', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.5);
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid rgba(26, 43, 60, 0.2);
        }

        .back-link:hover {
            transform: translateX(-5px);
            background-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        body.dark-theme .back-link {
            color: rgba(255, 255, 255, 0.9);
            background-color: rgba(30, 30, 40, 0.6);
            border: 1px solid rgba(0, 204, 255, 0.3);
        }

        body.dark-theme .back-link:hover {
            background-color: rgba(40, 40, 50, 0.8);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #1a2b3c;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading-text {
            font-size: 18px;
            color: #1a2b3c;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body.dark-theme .loading-content {
            background-color: #1a2b3c;
        }

        body.dark-theme .loading-spinner {
            border: 5px solid #333;
            border-top: 5px solid #00ccff;
        }

        body.dark-theme .loading-text {
            color: white;
        }

        .mood-container h1 {
            font-family: 'Azonix', sans-serif;
            font-size: 28px;
            margin-bottom: 15px;
            color: #222;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .mood-container p {
            font-family: 'Azonix', sans-serif;
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 0.05em;
            line-height: 1.6;
        }

        .mood-section {
            margin-bottom: 40px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .mood-section h2 {
            font-family: 'Azonix', sans-serif;
            font-size: 20px;
            color: #1a2b3c;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .mood-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .mood-card {
            flex: 1 1 calc(33.333% - 15px);
            min-width: 200px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mood-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.7);
        }

        .mood-card.selected {
            border-color: #1a2b3c;
            background-color: rgba(26, 43, 60, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1), 0 0 10px rgba(0, 204, 255, 0.2);
        }

        .mood-card h3 {
            font-family: 'Azonix', sans-serif;
            font-size: 16px;
            color: #1a2b3c;
            margin-bottom: 10px;
        }

        .mood-card p {
            font-family: Arial, sans-serif;
            font-size: 14px;
            color: #555;
            margin-bottom: 0;
            text-align: center;
        }

        .mood-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .mood-card .mood-emoji {
            position: absolute;
            font-size: 120px;
            opacity: 0.1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
            transition: all 0.3s ease;
        }

        .mood-card:hover .mood-emoji {
            opacity: 0.2;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .action-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-family: 'Azonix', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn {
            background-color: rgba(255, 255, 255, 0.5);
            color: #1a2b3c;
            border: 1px solid rgba(26, 43, 60, 0.3);
        }

        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }

        .continue-btn {
            background: linear-gradient(135deg, #1a2b3c, #2a3b4c);
            color: white;
            border: 1px solid rgba(0, 204, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 5px rgba(0, 204, 255, 0.3);
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 0 10px rgba(0, 204, 255, 0.4);
        }

        .continue-btn:disabled {
            background: #ccc;
            color: #666;
            border: 1px solid #bbb;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dark theme styles */
        body.dark-theme .mood-container {
            background-color: rgba(20, 20, 30, 0.7);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(0, 255, 170, 0.1);
            border: 1px solid rgba(0, 255, 170, 0.1);
        }

        body.dark-theme .mood-container h1 {
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .mood-container p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.dark-theme .mood-section h2 {
            color: rgba(0, 204, 255, 0.9);
        }

        body.dark-theme .mood-card {
            background-color: rgba(30, 30, 40, 0.6);
            border: 2px solid rgba(30, 30, 40, 0.8);
        }

        body.dark-theme .mood-card:hover {
            background-color: rgba(40, 40, 50, 0.8);
        }

        body.dark-theme .mood-card.selected {
            border-color: rgba(0, 204, 255, 0.6);
            background-color: rgba(0, 204, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(0, 204, 255, 0.3);
        }

        body.dark-theme .mood-card h3 {
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .mood-card p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.dark-theme .back-btn {
            background-color: rgba(30, 30, 40, 0.6);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 204, 255, 0.3);
        }

        body.dark-theme .back-btn:hover {
            background-color: rgba(40, 40, 50, 0.8);
        }

        /* Mood-specific styles */
        .mood-card[data-mood="focused"] { border-left: 4px solid #3498db; }
        .mood-card[data-mood="creative"] { border-left: 4px solid #e74c3c; }
        .mood-card[data-mood="decisive"] { border-left: 4px solid #2ecc71; }
        .mood-card[data-mood="expressive"] { border-left: 4px solid #f39c12; }
        .mood-card[data-mood="analytical"] { border-left: 4px solid #9b59b6; }
        .mood-card[data-mood="versatile"] { border-left: 4px solid #1abc9c; }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">QUIZERA</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="feature.html">Features</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="upload.html">Upload</a></li>
            </ul>
        </nav>
    </header>

    <!-- Background iframe -->
    <div class="background-container">
        <iframe src="https://my.spline.design/backlightbgeffect-q6UPGQpR45rNxmZOW7x3JUP5/" frameborder="0" width="100%" height="100%" allow="autoplay; fullscreen; vr" loading="lazy"></iframe>
    </div>

    <div class="mood-container">
        <div class="header-nav">
            <a href="upload.html" class="back-link">← Back to Upload</a>
        </div>
        <h1>How Are You Feeling Today?</h1>
        <p>Choose your mood to customize your quiz experience</p>

        <div class="mood-section">
            <h2>📝 Question Format</h2>
            <div class="mood-cards" id="mood-options">
                <div class="mood-card" data-mood="focused" data-format="1">
                    <div class="icon">🎯</div>
                    <div class="mood-emoji">🎯</div>
                    <h3>Focused</h3>
                    <p>I want direct, clear questions</p>
                    <p class="format-info">Multiple Choice Questions</p>
                </div>
                <div class="mood-card" data-mood="creative" data-format="2">
                    <div class="icon">💡</div>
                    <div class="mood-emoji">💡</div>
                    <h3>Creative</h3>
                    <p>I want to fill in the blanks</p>
                    <p class="format-info">Fill in the Blanks</p>
                </div>
                <div class="mood-card" data-mood="decisive" data-format="3">
                    <div class="icon">⚖️</div>
                    <div class="mood-emoji">⚖️</div>
                    <h3>Decisive</h3>
                    <p>I want to judge statements</p>
                    <p class="format-info">True/False Questions</p>
                </div>
                <div class="mood-card" data-mood="expressive" data-format="4">
                    <div class="icon">✏️</div>
                    <div class="mood-emoji">✏️</div>
                    <h3>Expressive</h3>
                    <p>I want to write brief answers</p>
                    <p class="format-info">Short Answer Questions</p>
                </div>
                <div class="mood-card" data-mood="analytical" data-format="5">
                    <div class="icon">📝</div>
                    <div class="mood-emoji">📝</div>
                    <h3>Analytical</h3>
                    <p>I want to explore topics deeply</p>
                    <p class="format-info">Long Answer Questions</p>
                </div>
                <div class="mood-card" data-mood="versatile" data-format="6">
                    <div class="icon">🔄</div>
                    <div class="mood-emoji">🔄</div>
                    <h3>Versatile</h3>
                    <p>I want variety in my questions</p>
                    <p class="format-info">Mix of All Types</p>
                </div>
            </div>
        </div>

        <div class="mood-section">
            <h2>🔥 Difficulty Level</h2>
            <div class="mood-cards" id="difficulty-options">
                <div class="mood-card" data-difficulty="1">
                    <div class="icon">😌</div>
                    <div class="mood-emoji">😌</div>
                    <h3>Relaxed</h3>
                    <p>I want to take it easy today</p>
                    <p class="difficulty-info">Easy Difficulty</p>
                </div>
                <div class="mood-card" data-difficulty="2">
                    <div class="icon">😊</div>
                    <div class="mood-emoji">😊</div>
                    <h3>Balanced</h3>
                    <p>I want a moderate challenge</p>
                    <p class="difficulty-info">Medium Difficulty</p>
                </div>
                <div class="mood-card" data-difficulty="3">
                    <div class="icon">🤔</div>
                    <div class="mood-emoji">🤔</div>
                    <h3>Ambitious</h3>
                    <p>I want to push my limits</p>
                    <p class="difficulty-info">Hard Difficulty</p>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn back-btn" id="back-btn">Back</button>
            <button class="action-btn continue-btn" id="continue-btn" disabled>Continue</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
            }

            // Get PDF data from localStorage
            const pdfData = JSON.parse(localStorage.getItem('pdfData') || '{}');
            console.log('PDF data retrieved from localStorage:', pdfData);

            // If no PDF data, create dummy data for testing
            if (!pdfData.fileName) {
                console.log('No PDF data found, using dummy data for testing');
                // Create dummy PDF data for testing
                const dummyData = {
                    fileName: 'sample.pdf',
                    fileSize: 1024 * 1024,
                    fileType: 'application/pdf',
                    uploadDate: new Date().toISOString()
                };
                localStorage.setItem('pdfData', JSON.stringify(dummyData));
            }

            // Get DOM elements
            const moodOptions = document.querySelectorAll('#mood-options .mood-card');
            const difficultyOptions = document.querySelectorAll('#difficulty-options .mood-card');
            const backBtn = document.getElementById('back-btn');
            const continueBtn = document.getElementById('continue-btn');

            // Selected options
            let selectedFormat = null;
            let selectedDifficulty = null;
            let selectedMood = null;

            // Add click event to mood options
            moodOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    moodOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Update selected format and mood
                    selectedFormat = option.dataset.format;
                    selectedMood = option.dataset.mood;
                    // Check if both options are selected
                    checkSelections();
                });
            });

            // Add click event to difficulty options
            difficultyOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    difficultyOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Update selected difficulty
                    selectedDifficulty = option.dataset.difficulty;
                    // Check if both options are selected
                    checkSelections();
                });
            });

            // Check if both format and difficulty are selected
            function checkSelections() {
                if (selectedFormat && selectedDifficulty) {
                    continueBtn.disabled = false;
                } else {
                    continueBtn.disabled = true;
                }
            }

            // Back button event
            backBtn.addEventListener('click', () => {
                window.location.href = 'upload.html';
            });

            // Continue button event
            continueBtn.addEventListener('click', () => {
                // Store the selected options in localStorage
                localStorage.setItem('quizPreferences', JSON.stringify({
                    format: selectedFormat,
                    difficulty: selectedDifficulty,
                    mood: selectedMood
                }));

                // Show loading overlay
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'loading-overlay';
                loadingOverlay.innerHTML = `
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Generating quiz questions...</div>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);

                // Get the PDF ID from localStorage
                const pdfId = localStorage.getItem('pdfId');

                if (!pdfId) {
                    console.error('No PDF ID found in localStorage');
                    alert('Error: No PDF found. Please upload a PDF first.');
                    window.location.href = 'upload.html';
                    return;
                }

                // Create form data for the API request
                const formData = new FormData();
                formData.append('pdf_id', pdfId);
                formData.append('quiz_type', selectedFormat);
                formData.append('difficulty', selectedDifficulty);
                formData.append('num_questions', 5);

                // Call the API to generate the quiz
                fetch('http://localhost:5000/api/generate-quiz', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(quizData => {
                    console.log('Quiz generated successfully:', quizData);

                    // Store the quiz data in localStorage
                    localStorage.setItem('currentQuiz', JSON.stringify(quizData));

                    // Redirect to the quiz play page
                    window.location.href = 'quiz-play.html';
                })
                .catch(error => {
                    console.error('Error generating quiz:', error);

                    // If server is not running, use client-side simulation
                    console.log('Falling back to client-side simulation');
                    const simulatedQuiz = createSimulatedQuiz(selectedFormat, selectedDifficulty, 5);
                    localStorage.setItem('currentQuiz', JSON.stringify(simulatedQuiz));

                    // Redirect to the quiz play page
                    window.location.href = 'quiz-play.html';
                })
                .finally(() => {
                    // Remove loading overlay
                    document.body.removeChild(loadingOverlay);
                });
            });

            // Function to create simulated quiz data for testing
            function createSimulatedQuiz(quizType, difficulty, numQuestions) {
                const questions = [];
                const difficultyText = difficulty === '1' ? 'easy' : (difficulty === '3' ? 'hard' : 'medium');

                // Generate questions based on quiz type
                for (let i = 0; i < numQuestions; i++) {
                    let question;

                    switch (quizType) {
                        case '1': // MCQs
                            question = {
                                question: `Sample ${difficultyText} multiple choice question #${i+1}?`,
                                options: [
                                    "Option A - This is a sample answer",
                                    "Option B - This is another sample answer",
                                    "Option C - This is the correct answer",
                                    "Option D - This is the last sample answer"
                                ],
                                answer: "Option C - This is the correct answer",
                                explanation: `This is an explanation for the ${difficultyText} multiple choice question #${i+1}.`
                            };
                            break;

                        case '2': // Fill in the blanks
                            question = {
                                question: `This is a sample ${difficultyText} fill in the blank question #${i+1}. The capital of France is _____.`,
                                answer: "Paris",
                                explanation: `Paris is the capital of France. This is a ${difficultyText} level question.`
                            };
                            break;

                        case '3': // True/False
                            question = {
                                question: `Sample ${difficultyText} true/false statement #${i+1}: The Earth is flat.`,
                                options: ["True", "False"],
                                answer: "False",
                                explanation: `The Earth is approximately spherical in shape. This is a ${difficultyText} level question.`
                            };
                            break;

                        case '4': // Short answer
                            question = {
                                question: `Sample ${difficultyText} short answer question #${i+1}: Briefly explain photosynthesis.`,
                                answer: "Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with carbon dioxide and water.",
                                explanation: `This is a ${difficultyText} level short answer question about a basic biological process.`
                            };
                            break;

                        case '5': // Long answer
                            question = {
                                question: `Sample ${difficultyText} long answer question #${i+1}: Discuss the causes and effects of climate change.`,
                                answer: "Climate change is primarily caused by human activities such as burning fossil fuels, deforestation, and industrial processes that release greenhouse gases into the atmosphere. These gases trap heat and lead to global warming. Effects include rising sea levels, extreme weather events, disruption of ecosystems, and threats to food security.",
                                explanation: `This is a ${difficultyText} level long answer question that requires detailed knowledge of environmental science.`
                            };
                            break;

                        case '6': // Mix of all types
                            // Determine question type based on index
                            const typeIndex = i % 5;
                            if (typeIndex === 0) {
                                question = {
                                    question: `Sample ${difficultyText} multiple choice question #${i+1}?`,
                                    options: [
                                        "Option A - This is a sample answer",
                                        "Option B - This is another sample answer",
                                        "Option C - This is the correct answer",
                                        "Option D - This is the last sample answer"
                                    ],
                                    answer: "Option C - This is the correct answer",
                                    explanation: `This is an explanation for the ${difficultyText} multiple choice question #${i+1}.`
                                };
                            } else if (typeIndex === 1) {
                                question = {
                                    question: `This is a sample ${difficultyText} fill in the blank question #${i+1}. The capital of France is _____.`,
                                    answer: "Paris",
                                    explanation: `Paris is the capital of France. This is a ${difficultyText} level question.`
                                };
                            } else if (typeIndex === 2) {
                                question = {
                                    question: `Sample ${difficultyText} true/false statement #${i+1}: The Earth is flat.`,
                                    options: ["True", "False"],
                                    answer: "False",
                                    explanation: `The Earth is approximately spherical in shape. This is a ${difficultyText} level question.`
                                };
                            } else if (typeIndex === 3) {
                                question = {
                                    question: `Sample ${difficultyText} short answer question #${i+1}: Briefly explain photosynthesis.`,
                                    answer: "Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with carbon dioxide and water.",
                                    explanation: `This is a ${difficultyText} level short answer question about a basic biological process.`
                                };
                            } else {
                                question = {
                                    question: `Sample ${difficultyText} long answer question #${i+1}: Discuss the causes and effects of climate change.`,
                                    answer: "Climate change is primarily caused by human activities such as burning fossil fuels, deforestation, and industrial processes that release greenhouse gases into the atmosphere. These gases trap heat and lead to global warming. Effects include rising sea levels, extreme weather events, disruption of ecosystems, and threats to food security.",
                                    explanation: `This is a ${difficultyText} level long answer question that requires detailed knowledge of environmental science.`
                                };
                            }
                            break;

                        default:
                            question = {
                                question: `Sample question #${i+1}?`,
                                options: [
                                    "Option A - This is a sample answer",
                                    "Option B - This is another sample answer",
                                    "Option C - This is the correct answer",
                                    "Option D - This is the last sample answer"
                                ],
                                answer: "Option C - This is the correct answer",
                                explanation: "This is a sample explanation."
                            };
                    }

                    questions.push(question);
                }

                return { questions };
            }
        });
    </script>
</body>
</html>
