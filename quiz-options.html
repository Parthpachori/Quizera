<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZERA - Customize Quiz</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="upload-styles.css">
    <link rel="stylesheet" href="animated-bg.css">
    <script src="animated-bg.js"></script>
    <script src="quiz-agent.js"></script>
    <style>
        /* Override scrolling behavior */
        html, body {
            height: auto !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }

        .options-container {
            max-width: 800px;
            margin: 120px auto 40px;
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 20px rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 2;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header-nav {
            position: relative;
            margin-bottom: 20px;
        }

        .back-link {
            position: absolute;
            left: 0;
            top: 0;
            font-family: 'Azonix', sans-serif;
            font-size: 14px;
            color: #1a2b3c;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: #3a4b5c;
            transform: translateX(-5px);
        }

        .options-container h1 {
            font-family: 'Azonix', sans-serif;
            font-size: 28px;
            margin-bottom: 15px;
            color: #222;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .options-container p {
            font-family: 'Azonix', sans-serif;
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 0.05em;
            line-height: 1.6;
        }

        .option-section {
            margin-bottom: 40px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .option-section h2 {
            font-family: 'Azonix', sans-serif;
            font-size: 20px;
            color: #1a2b3c;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .option-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .option-card {
            flex: 1 1 calc(33.333% - 15px);
            min-width: 200px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.7);
        }

        .option-card.selected {
            border-color: #1a2b3c;
            background-color: rgba(26, 43, 60, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1), 0 0 10px rgba(0, 204, 255, 0.2);
        }

        .option-card h3 {
            font-family: 'Azonix', sans-serif;
            font-size: 16px;
            color: #1a2b3c;
            margin-bottom: 10px;
        }

        .option-card p {
            font-family: Arial, sans-serif;
            font-size: 14px;
            color: #555;
            margin-bottom: 0;
            text-align: center;
        }

        .option-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .num-questions {
            margin: 30px auto;
            max-width: 300px;
        }

        .num-questions label {
            display: block;
            font-family: 'Azonix', sans-serif;
            font-size: 16px;
            color: #1a2b3c;
            margin-bottom: 10px;
            text-align: center;
        }

        .num-questions input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(26, 43, 60, 0.3);
            background-color: rgba(255, 255, 255, 0.5);
            font-family: Arial, sans-serif;
            font-size: 16px;
            color: #333;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .action-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-family: 'Azonix', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn {
            background-color: rgba(255, 255, 255, 0.5);
            color: #1a2b3c;
            border: 1px solid rgba(26, 43, 60, 0.3);
        }

        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }

        .generate-btn {
            background: linear-gradient(135deg, #1a2b3c, #2a3b4c);
            color: white;
            border: 1px solid rgba(0, 204, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 5px rgba(0, 204, 255, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 0 10px rgba(0, 204, 255, 0.4);
        }

        .generate-btn:disabled {
            background: #ccc;
            color: #666;
            border: 1px solid #bbb;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dark theme styles */
        body.dark-theme .options-container {
            background-color: rgba(20, 20, 30, 0.7);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(0, 255, 170, 0.1);
            border: 1px solid rgba(0, 255, 170, 0.1);
        }

        body.dark-theme .back-link {
            color: rgba(0, 204, 255, 0.9);
        }

        body.dark-theme .back-link:hover {
            color: rgba(0, 255, 170, 0.9);
        }

        body.dark-theme .options-container h1 {
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .options-container p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.dark-theme .option-section h2 {
            color: rgba(0, 204, 255, 0.9);
        }

        body.dark-theme .option-card {
            background-color: rgba(30, 30, 40, 0.6);
            border: 2px solid rgba(30, 30, 40, 0.8);
        }

        body.dark-theme .option-card:hover {
            background-color: rgba(40, 40, 50, 0.8);
        }

        body.dark-theme .option-card.selected {
            border-color: rgba(0, 204, 255, 0.6);
            background-color: rgba(0, 204, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(0, 204, 255, 0.3);
        }

        body.dark-theme .option-card h3 {
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .option-card p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.dark-theme .num-questions label {
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .num-questions input {
            background-color: rgba(30, 30, 40, 0.6);
            border: 1px solid rgba(0, 204, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-theme .back-btn {
            background-color: rgba(30, 30, 40, 0.6);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 204, 255, 0.3);
        }

        body.dark-theme .back-btn:hover {
            background-color: rgba(40, 40, 50, 0.8);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #1a2b3c;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-family: 'Azonix', sans-serif;
            font-size: 18px;
            color: white;
            text-align: center;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">QUIZERA</div>
        <nav>
            <ul>
                <li><a href="javascript:void(0);" onclick="if(confirm('Are you sure you want to leave this page? Your quiz progress will be lost.')) window.location.href='index.html';">Home</a></li>
                <li><a href="javascript:void(0);" onclick="if(confirm('Are you sure you want to leave this page? Your quiz progress will be lost.')) window.location.href='feature.html';">Features</a></li>
                <li><a href="javascript:void(0);" onclick="if(confirm('Are you sure you want to leave this page? Your quiz progress will be lost.')) window.location.href='about.html';">About</a></li>
                <li><a href="javascript:void(0);" onclick="if(confirm('Are you sure you want to leave this page? Your quiz progress will be lost.')) window.location.href='contact.html';">Contact</a></li>
                <li><a href="upload.html">Upload</a></li>
            </ul>
        </nav>
    </header>

    <!-- Animated background will be added by JavaScript -->

    <div class="options-container">
        <div class="header-nav">
            <a href="upload.html" class="back-link">← Back to Upload</a>
        </div>
        <h1>Customize Your Quiz</h1>
        <p id="pdf-info">Select your preferred quiz format and difficulty level</p>

        <div class="option-section">
            <h2>📝 Question Format</h2>
            <div class="option-cards" id="format-options">
                <div class="option-card" data-value="1">
                    <div class="icon">🔤</div>
                    <h3>Multiple Choice</h3>
                    <p>Questions with multiple answer options</p>
                </div>
                <div class="option-card" data-value="2">
                    <div class="icon">📝</div>
                    <h3>Fill in the Blanks</h3>
                    <p>Complete sentences by filling missing words</p>
                </div>
                <div class="option-card" data-value="3">
                    <div class="icon">✓✗</div>
                    <h3>True/False</h3>
                    <p>Determine if statements are true or false</p>
                </div>
                <div class="option-card" data-value="4">
                    <div class="icon">📄</div>
                    <h3>Short Answer</h3>
                    <p>Brief responses in a few sentences</p>
                </div>
                <div class="option-card" data-value="5">
                    <div class="icon">📑</div>
                    <h3>Long Answer</h3>
                    <p>Detailed explanations and discussions</p>
                </div>
                <div class="option-card" data-value="6">
                    <div class="icon">🔄</div>
                    <h3>Mixed Format</h3>
                    <p>Combination of all question types</p>
                </div>
            </div>
        </div>

        <div class="option-section">
            <h2>🎯 Difficulty Level</h2>
            <div class="option-cards" id="difficulty-options">
                <div class="option-card" data-value="1">
                    <div class="icon">🟢</div>
                    <h3>Easy</h3>
                    <p>Basic concepts and straightforward questions</p>
                </div>
                <div class="option-card" data-value="2">
                    <div class="icon">🟡</div>
                    <h3>Medium</h3>
                    <p>Moderate complexity requiring good understanding</p>
                </div>
                <div class="option-card" data-value="3">
                    <div class="icon">🔴</div>
                    <h3>Hard</h3>
                    <p>Challenging questions requiring deep knowledge</p>
                </div>
            </div>
        </div>

        <div class="num-questions">
            <label for="num-questions-input">Number of Questions:</label>
            <input type="number" id="num-questions-input" min="1" max="20" value="5">
        </div>

        <div class="action-buttons">
            <button class="action-btn back-btn" id="back-btn">Back</button>
            <button class="action-btn generate-btn" id="generate-btn" disabled>Generate Quiz</button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Generating your quiz...</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
            }

            // Get PDF data from localStorage
            const pdfData = JSON.parse(localStorage.getItem('pdfData') || '{}');
            console.log('PDF data retrieved from localStorage:', pdfData);

            // Get quiz preferences from localStorage (set in quiz-mood.html)
            const quizPreferences = JSON.parse(localStorage.getItem('quizPreferences') || '{}');
            console.log('Quiz preferences retrieved from localStorage:', quizPreferences);

            // Check if we have generated quiz data from the server
            const generatedQuiz = JSON.parse(localStorage.getItem('generatedQuiz') || 'null');
            if (generatedQuiz) {
                console.log('Found generated quiz data from server:', generatedQuiz);
            }

            // If no PDF data, create dummy data for testing
            if (!pdfData.fileName) {
                console.log('No PDF data found, using dummy data for testing');
                // Create dummy PDF data for testing
                const dummyData = {
                    fileName: 'sample.pdf',
                    fileSize: 1024 * 1024,
                    fileType: 'application/pdf',
                    uploadDate: new Date().toISOString()
                };
                localStorage.setItem('pdfData', JSON.stringify(dummyData));
                console.log('Dummy PDF data created:', dummyData);
            } else {
                console.log('Using existing PDF data:', pdfData.fileName);

                // Update the page title to include the PDF name
                document.title = `QUIZERA - Quiz Options for ${pdfData.fileName}`;

                // Update the PDF info text
                const pdfInfoElement = document.getElementById('pdf-info');
                if (pdfInfoElement) {
                    pdfInfoElement.textContent = `Customize quiz for "${pdfData.fileName}"`;
                }
            }

            // Apply the selected preferences from quiz-mood.html if available
            if (quizPreferences.format && quizPreferences.difficulty) {
                console.log('Applying saved preferences:', quizPreferences);

                // Select the format option based on the saved preference
                const formatOption = document.querySelector(`#format-options .option-card[data-value="${quizPreferences.format}"]`);
                if (formatOption) {
                    formatOption.click(); // Simulate a click to select it
                }

                // Select the difficulty option based on the saved preference
                const difficultyOption = document.querySelector(`#difficulty-options .option-card[data-value="${quizPreferences.difficulty}"]`);
                if (difficultyOption) {
                    difficultyOption.click(); // Simulate a click to select it
                }
            }

            // Get DOM elements
            const formatOptions = document.querySelectorAll('#format-options .option-card');
            const difficultyOptions = document.querySelectorAll('#difficulty-options .option-card');
            const numQuestionsInput = document.getElementById('num-questions-input');
            const backBtn = document.getElementById('back-btn');
            const generateBtn = document.getElementById('generate-btn');
            const loadingOverlay = document.getElementById('loading-overlay');

            // Selected options
            let selectedFormat = null;
            let selectedDifficulty = null;

            // Add click event to format options
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Update selected format
                    selectedFormat = option.dataset.value;
                    // Check if both options are selected
                    checkSelections();
                });
            });

            // Add click event to difficulty options
            difficultyOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    difficultyOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Update selected difficulty
                    selectedDifficulty = option.dataset.value;
                    // Check if both options are selected
                    checkSelections();
                });
            });

            // Check if both format and difficulty are selected
            function checkSelections() {
                if (selectedFormat && selectedDifficulty) {
                    generateBtn.disabled = false;
                } else {
                    generateBtn.disabled = true;
                }
            }

            // Back button event
            backBtn.addEventListener('click', () => {
                window.location.href = 'upload.html';
            });

            // Generate button event
            generateBtn.addEventListener('click', async () => {
                // Show loading overlay
                loadingOverlay.style.display = 'flex';

                try {
                    // Get number of questions
                    const numQuestions = parseInt(numQuestionsInput.value) || 5;

                    // In a real implementation, we would call the agent with the actual PDF file
                    // But since we can't store the file in localStorage, we'll use simulated data

                    // Create simulated quiz data based on selected options
                    const simulatedQuiz = createSimulatedQuiz(selectedFormat, selectedDifficulty, numQuestions);

                    // Store the quiz data in localStorage
                    localStorage.setItem('currentQuiz', JSON.stringify(simulatedQuiz));

                    // Simulate processing time
                    setTimeout(() => {
                        // Hide loading overlay
                        loadingOverlay.style.display = 'none';

                        // Redirect to the new quiz play page
                        window.location.href = 'quiz-play.html';
                    }, 2000);
                } catch (error) {
                    console.error('Error generating quiz:', error);

                    // Hide loading overlay
                    loadingOverlay.style.display = 'none';

                    // Show error message
                    alert('Error generating quiz: ' + error.message);
                }
            });

            // Function to create simulated quiz data for testing
            function createSimulatedQuiz(quizType, difficulty, numQuestions) {
                const questions = [];
                const difficultyText = difficulty === '1' ? 'easy' : (difficulty === '3' ? 'hard' : 'medium');

                // Generate questions based on quiz type
                for (let i = 0; i < numQuestions; i++) {
                    let question;

                    switch (quizType) {
                        case '1': // MCQs
                            question = {
                                question: `Sample ${difficultyText} multiple choice question #${i+1}?`,
                                options: [
                                    "Option A - This is a sample answer",
                                    "Option B - This is another sample answer",
                                    "Option C - This is the correct answer",
                                    "Option D - This is the last sample answer"
                                ],
                                answer: "Option C - This is the correct answer",
                                explanation: `This is an explanation for the ${difficultyText} multiple choice question #${i+1}.`
                            };
                            break;

                        case '2': // Fill in the blanks
                            question = {
                                question: `This is a sample ${difficultyText} fill in the blank question #${i+1}. The capital of France is _____.`,
                                answer: "Paris",
                                explanation: `Paris is the capital of France. This is a ${difficultyText} level question.`
                            };
                            break;

                        case '3': // True/False
                            question = {
                                question: `Sample ${difficultyText} true/false statement #${i+1}: The Earth is flat.`,
                                answer: "False",
                                explanation: `The Earth is approximately spherical in shape. This is a ${difficultyText} level question.`
                            };
                            break;

                        case '4': // Short answer
                            question = {
                                question: `Sample ${difficultyText} short answer question #${i+1}: Briefly explain photosynthesis.`,
                                answer: "Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with carbon dioxide and water.",
                                explanation: `This is a ${difficultyText} level short answer question about a basic biological process.`
                            };
                            break;

                        case '5': // Long answer
                            question = {
                                question: `Sample ${difficultyText} long answer question #${i+1}: Discuss the causes and effects of climate change.`,
                                answer: "Climate change is primarily caused by human activities such as burning fossil fuels, deforestation, and industrial processes that release greenhouse gases into the atmosphere. These gases trap heat and lead to global warming. Effects include rising sea levels, extreme weather events, disruption of ecosystems, and threats to food security.",
                                explanation: `This is a ${difficultyText} level long answer question that requires detailed knowledge of environmental science.`
                            };
                            break;

                        case '6': // Mix of all types
                            // Determine question type based on index
                            const typeIndex = i % 5;
                            if (typeIndex === 0) {
                                question = {
                                    question: `Sample ${difficultyText} multiple choice question #${i+1}?`,
                                    options: [
                                        "Option A - This is a sample answer",
                                        "Option B - This is another sample answer",
                                        "Option C - This is the correct answer",
                                        "Option D - This is the last sample answer"
                                    ],
                                    answer: "Option C - This is the correct answer",
                                    explanation: `This is an explanation for the ${difficultyText} multiple choice question #${i+1}.`
                                };
                            } else if (typeIndex === 1) {
                                question = {
                                    question: `This is a sample ${difficultyText} fill in the blank question #${i+1}. The capital of France is _____.`,
                                    answer: "Paris",
                                    explanation: `Paris is the capital of France. This is a ${difficultyText} level question.`
                                };
                            } else if (typeIndex === 2) {
                                question = {
                                    question: `Sample ${difficultyText} true/false statement #${i+1}: The Earth is flat.`,
                                    answer: "False",
                                    explanation: `The Earth is approximately spherical in shape. This is a ${difficultyText} level question.`
                                };
                            } else if (typeIndex === 3) {
                                question = {
                                    question: `Sample ${difficultyText} short answer question #${i+1}: Briefly explain photosynthesis.`,
                                    answer: "Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with carbon dioxide and water.",
                                    explanation: `This is a ${difficultyText} level short answer question about a basic biological process.`
                                };
                            } else {
                                question = {
                                    question: `Sample ${difficultyText} long answer question #${i+1}: Discuss the causes and effects of climate change.`,
                                    answer: "Climate change is primarily caused by human activities such as burning fossil fuels, deforestation, and industrial processes that release greenhouse gases into the atmosphere. These gases trap heat and lead to global warming. Effects include rising sea levels, extreme weather events, disruption of ecosystems, and threats to food security.",
                                    explanation: `This is a ${difficultyText} level long answer question that requires detailed knowledge of environmental science.`
                                };
                            }
                            break;

                        default:
                            question = {
                                question: `Sample question #${i+1}?`,
                                options: [
                                    "Option A - This is a sample answer",
                                    "Option B - This is another sample answer",
                                    "Option C - This is the correct answer",
                                    "Option D - This is the last sample answer"
                                ],
                                answer: "Option C - This is the correct answer",
                                explanation: "This is a sample explanation."
                            };
                    }

                    questions.push(question);
                }

                return { questions };
            }
        });
    </script>
</body>
</html>
